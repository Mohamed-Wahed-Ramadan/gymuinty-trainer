<div *ngIf="isOpen" class="modal-overlay" [@fadeIn] (click)="onBackdropClick()">
  <div class="modal-container" [@modalSlideIn] (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <div class="program-title-section">
        <h2 class="modal-title text-black">{{ program?.title }}</h2>
        <div class="program-meta-top">
          <span class="badge text-black" [ngClass]="'badge-type-' + program?.type">
            <i [class]="'bi ' + getProgramTypeIcon(program?.type)"></i>
            {{ getProgramTypeLabel(program?.type) }}
          </span>
          <span class="duration-badge text-black">
            <i class="bi bi-calendar3"></i> {{ program?.durationWeeks }} weeks
          </span>
        </div>
      </div>
      <button class="btn-close text-black" (click)="close()" aria-label="Close">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="spinner"></div>
      <p>{{ 'shared.program.loading' | translate }}</p>
    </div>

    <!-- Content -->
    <div *ngIf="!isLoading && program" class="modal-content">
      <!-- Program Description Section -->
      <div class="section">
        <h3 class="section-title">
          <i class="bi bi-info-circle"></i> {{ 'shared.program.overview' | translate }}
        </h3>
        <p class="description">{{ program.description }}</p>

        <div class="program-details-grid">
          <div class="detail-item" *ngIf="program.trainerUserName">
            <span class="detail-label">
              <i class="bi bi-person-badge"></i> {{ 'shared.program.trainer' | translate }}
            </span>
            <span class="detail-value">{{ program.trainerUserName }}</span>
          </div>
          <div class="detail-item" *ngIf="program.price">
            <span class="detail-label">
              <i class="bi bi-tag"></i> {{ 'shared.program.price' | translate }}
            </span>
            <span class="detail-value">{{ program.price | currency }}</span>
          </div>
          <div class="detail-item" *ngIf="program.maxClients">
            <span class="detail-label">
              <i class="bi bi-people"></i> {{ 'shared.program.maxClients' | translate }}
            </span>
            <span class="detail-value">{{ program.maxClients }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">
              <i class="bi bi-globe"></i> {{ 'shared.program.visibility' | translate }}
            </span>
            <span class="detail-value">{{ program.isPublic ? ('shared.program.public' | translate) :
              ('shared.program.private' | translate) }}</span>
          </div>
        </div>
      </div>

      <!-- Weeks and Days Section -->
      <div class="section" *ngIf="program.weeks && program.weeks.length > 0">
        <h3 class="section-title">
          <i class="bi bi-diagram-3"></i> {{ 'shared.program.structure' | translate }}
        </h3>

        <div class="weeks-container">
          <div class="week-item" *ngFor="let week of program.weeks">
            <div class="week-header" (click)="toggleWeek(week.id)">
              <div class="week-info">
                <h4 class="week-title">
                  <i class="bi" [ngClass]="isWeekExpanded(week.id) ? 'bi-chevron-down' : 'bi-chevron-right'"></i>
                  {{ 'shared.program.week' | translate }} {{ week.weekNumber }}
                </h4>
              </div>
              <span class="days-count">{{ week.days?.length || 0 }} {{ 'shared.program.days' | translate }}</span>
            </div>

            <!-- Days -->
            <div *ngIf="isWeekExpanded(week.id)" class="week-content">
              <div class="day-item" *ngFor="let day of week.days">
                <div class="day-header" (click)="toggleDay(day.id)">
                  <div class="day-info">
                    <h5 class="day-title">
                      <i class="bi" [ngClass]="isDayExpanded(day.id) ? 'bi-chevron-down' : 'bi-chevron-right'"></i>
                      <span class="day-number">{{ 'shared.program.day' | translate }} {{ day.dayNumber }}</span>
                      <span class="day-name">{{ day.title }}</span>
                    </h5>
                  </div>
                  <span class="exercises-count">{{ day.exercises?.length || 0 }} exercises</span>
                </div>

                <!-- Exercises -->
                <div *ngIf="isDayExpanded(day.id)" class="day-content">
                  <div *ngIf="day.notes" class="day-notes">
                    <i class="bi bi-chat-left-text"></i> {{ day.notes }}
                  </div>

                  <div class="exercises-list">
                    <div class="exercise-item" *ngFor="let exercise of day.exercises; let idx = index">
                      <div class="exercise-order">{{ idx + 1 }}</div>
                      <div class="exercise-details">
                        <h6 class="exercise-title">{{ 'shared.program.exercise' | translate }} {{ exercise.orderIndex }}
                        </h6>

                        <div class="exercise-specs">
                          <span class="spec" *ngIf="exercise.sets">
                            <i class="bi bi-square"></i> {{ exercise.sets }} {{ 'shared.program.sets' | translate }}
                          </span>
                          <span class="spec" *ngIf="exercise.reps">
                            <i class="bi bi-repeat"></i> {{ exercise.reps }} {{ 'shared.program.reps' | translate }}
                          </span>
                          <span class="spec" *ngIf="exercise.restSeconds">
                            <i class="bi bi-hourglass"></i> {{ exercise.restSeconds }}s {{ 'shared.program.rest' |
                            translate }}
                          </span>
                          <span class="spec" *ngIf="exercise.tempo">
                            <i class="bi bi-speedometer2"></i> {{ exercise.tempo }}
                          </span>
                          <span class="spec" *ngIf="exercise.rpe">
                            <i class="bi bi-lightning"></i> RPE {{ exercise.rpe }}
                          </span>
                          <span class="spec" *ngIf="exercise.percent1RM">
                            <i class="bi bi-percent"></i> {{ exercise.percent1RM }}% 1RM
                          </span>
                        </div>

                        <div *ngIf="exercise.notes" class="exercise-notes">
                          üìù {{ exercise.notes }}
                        </div>

                        <div *ngIf="exercise.videoUrl" class="exercise-video">
                          <a [href]="exercise.videoUrl" target="_blank" class="video-link">
                            <i class="bi bi-play-circle"></i> {{ 'shared.program.watchFormVideo' | translate }}
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!program.weeks || program.weeks.length === 0" class="empty-state">
        <i class="bi bi-inbox"></i>
        <p>{{ 'shared.program.noStructure' | translate }}</p>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="close()">{{ 'common.close' | translate }}</button>
      <button class="btn btn-bton" *ngIf="program && !hideEnroll">
        <i class="bi bi-check-circle"></i> {{ 'shared.program.enrollNow' | translate }}
      </button>
    </div>
  </div>
</div>