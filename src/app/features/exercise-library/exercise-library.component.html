<div class="exercise-library">
  <h1>{{ 'exercises.title' | translate }}</h1>

  <!-- زر الـ add مخفي حسب الطلب -->
  <div style="margin-bottom:12px">
    <button class="btn btn-success" (click)="openCreate()"><i class="bi bi-plus-circle"></i> {{ 'exercises.newExercise'
      | translate }}</button>
  </div>

  <div class="controls">
    <div class="search-group">
      <input class="form-control search-input" placeholder="{{ 'exercises.searchPlaceholder' | translate }}"
        [(ngModel)]="searchTerm" (ngModelChange)="onSearch()" />
    </div>

    <div class="filters">
      <select class="form-select filter-select" [(ngModel)]="filterCategory" (change)="applyFilters()">
        <option value="">{{ 'common.all' | translate }} {{ 'exercises.category' | translate }}</option>
        <option *ngFor="let c of categories" [value]="c">{{ c }}</option>
      </select>
      <select class="form-select filter-select" [(ngModel)]="filterMuscle" (change)="applyFilters()">
        <option value="">{{ 'common.all' | translate }} {{ 'exercises.muscle' | translate }}</option>
        <option *ngFor="let m of muscleGroups" [value]="m">{{ m }}</option>
      </select>
      <select class="form-select filter-select" [(ngModel)]="filterEquipment" (change)="applyFilters()">
        <option value="">{{ 'common.all' | translate }} {{ 'exercises.equipment' | translate }}</option>
        <option *ngFor="let e of equipmentList" [value]="e">{{ e }}</option>
      </select>
    </div>
  </div>

  <div class="grid">
    <div class="card" *ngFor="let ex of filteredExercises">
      <img *ngIf="ex.thumbnailUrl" [src]="resolveUrl(ex.thumbnailUrl)" alt="{{ ex.name }}" />
      <div class="card-body">
        <h4 class="card-title">{{ ex.name }}</h4>
        <p class="meta">{{ ex.category }} · {{ ex.muscleGroup }} · {{ ex.equipment }}</p>
        <div class="action-row">
          <button class="btn btn-action btn-primary" (click)="openDetail(ex)"><i class="bi bi-eye"></i> {{
            'common.details' | translate }}</button>
          <button class="btn btn-action btn-success" (click)="addToDay(ex)"><i class="bi bi-plus"></i> {{ 'common.add' |
            translate }}</button>
          <button class="btn btn-action btn-warning" (click)="openEdit(ex)"><i class="bi bi-pencil"></i> {{
            'common.edit' | translate }}</button>
          <button class="btn btn-action btn-danger" (click)="deleteExercise(ex)"><i class="bi bi-trash"></i> {{
            'common.delete' | translate }}</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" *ngIf="selectedExercise">
    <div class="modal-content">
      <button class="close" (click)="closeDetail()">×</button>
      <h3>{{ selectedExercise.name }}</h3>
      <p>{{ selectedExercise.category }} · {{ selectedExercise.muscleGroup }}</p>
      <div style="text-align:center; margin:18px 0;">
        <a *ngIf="selectedExercise.videoDemoUrl" [href]="selectedExercise.videoDemoUrl" target="_blank" rel="noopener"
          class="btn btn-primary" style="display:inline-flex; align-items:center; gap:8px;">
          <i class="bi bi-play-circle"></i>
          {{ 'exercises.watchVideo' | translate }}
        </a>
        <div *ngIf="!selectedExercise.videoDemoUrl" style="margin-top:12px;color:#666;">
          <p>{{ 'exercises.noVideo' | translate }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Create / Edit Modal -->
  <div class="modal" *ngIf="showFormModal">
    <div class="modal-content">
      <button class="close" (click)="closeForm()">×</button>
      <h3>{{ isEditing ? ( 'exercises.editExercise' | translate ) : ( 'exercises.createExercise' | translate ) }}</h3>
      <form (submit)="submitForm($event)">
        <div style="display:flex; gap:8px; flex-wrap:wrap">
          <input class="form-control" placeholder="Name" [(ngModel)]="form.name" name="name" required />
          <input class="form-control" placeholder="Category" [(ngModel)]="form.category" name="category" />
          <input class="form-control" placeholder="Muscle Group" [(ngModel)]="form.muscleGroup" name="muscleGroup" />
          <input class="form-control" placeholder="Equipment" [(ngModel)]="form.equipment" name="equipment" />
          <label class="form-label">Thumbnail URL</label>
          <input class="form-control" placeholder="https://..." [(ngModel)]="form.thumbnailUrl" name="thumbnailUrl" />
          <label class="form-label">Video Demo URL (YouTube)</label>
          <input class="form-control" placeholder="https://youtube.com/..." [(ngModel)]="form.videoDemoUrl"
            name="videoDemoUrl" />
        </div>
        <div style="margin-top:8px">
          <button class="btn btn-primary" type="submit"><i class="bi bi-check-circle"></i> {{ isEditing ? (
            'common.save' | translate ) : ( 'common.create' | translate ) }}</button>
          <button class="btn btn-secondary ms-2" type="button" (click)="closeForm()"><i class="bi bi-x-circle"></i> {{
            'common.cancel' | translate }}</button>
        </div>
      </form>
    </div>
  </div>
<!-- Delete Confirmation Toast -->
<div *ngIf="deleteConfirmation.show" class="delete-confirmation-toast">
  <div class="toast-content">
    <div class="toast-icon">
      <i class="bi bi-exclamation-triangle"></i>
    </div>
    <div class="toast-body">
      <h5>{{ 'common.confirmDelete' | translate }}</h5>
      <p *ngIf="deleteConfirmation.item">
        Are you sure you want to delete "<strong>{{ deleteConfirmation.item.name }}</strong>"?
      </p>
    </div>
    <div class="toast-actions">
      <button class="btn btn-sm btn-secondary" (click)="cancelDelete()">
        {{ 'common.cancel' | translate }}
      </button>
      <button class="btn btn-sm btn-danger" (click)="confirmDelete()">
        <i class="bi bi-trash"></i> {{ 'common.delete' | translate }}
      </button>
    </div>
  </div>
</div>
</div>